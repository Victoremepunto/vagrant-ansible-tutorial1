<VirtualHost *:80>
    #ServerName {{apache.server_name}}

    #Redirect all http traffic to https if it is pointed at /jenkins /nexus /sonar
    #RewriteEngine On
    #RewriteCond %{HTTPS} off
    #RewriteCond %{REQUEST_URI} ^/(jenkins|nexus|sonar)/?.*$
    #RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>

    ProxyRequests Off

    ProxyPass /sonar {{apache.sonar_http}}
    ProxyPassReverse /sonar {{apache.sonar_http}}

    ProxyPass /nexus {{apache.nexus_http}}
    ProxyPassReverse /nexus {{apache.nexus_http}}

    ProxyPass /jenkins {{apache.jenkins_http}} nocanon
    ProxyPassReverse /jenkins {{apache.jenkins_http}}
    AllowEncodedSlashes NoDecode

    CustomLog /var/log/apache2/{{apache.custom_log_file}} combined
    ErrorLog /var/log/apache2/{{apache.error_log_file}}
</VirtualHost>

<VirtualHost *:443>
    SSLEngine on
    SSLCertificateFile {{apache.certificate_file}}
    SSLCertificateKeyFile {{apache.certificate_key_file}}
    SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>

    ProxyRequests Off

    ProxyPass /sonar {{apache.sonar_http}}
    ProxyPassReverse /sonar {{apache.sonar_http}}

    ProxyPass /nexus {{apache.nexus_http}}
    ProxyPassReverse /nexus {{apache.nexus_http}}

    ProxyPass /jenkins {{apache.jenkins_http}} nocanon
    ProxyPassReverse /jenkins {{apache.jenkins_http}}
    AllowEncodedSlashes NoDecode

    CustomLog /var/log/apache2/{{apache.custom_https_log}} combined
    ErrorLog /var/log/apache2/{{apache.error_https_log}}
</VirtualHost>